#!/bin/bash
set -e
script_dir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
. $script_dir/setup-env.sh

name=${1:-NativeScript}
platform=$2

echo "Setting up project $name..."

if [ -d ./$name ]; then
    echo "$name project already exists. Delete it and run the script again."
    exit
fi

$script_dir/clear-npm-cache.sh
$script_dir/download-latest-cli.sh
$script_dir/install-latest-cli.sh
$script_dir/create-project.sh $name
$script_dir/download-latest-modules.sh
(cd $name && npm install ../tns-core-modules.tgz)
rm -rf $name/app/tns_modules

if [ ! -z "$platform" ]; then
    if [ "$platform" == "android" ]; then
        $script_dir/download-latest-android-widgets.sh
        (cd $name && npm install ../tns-core-modules-widgets.tgz)
    fi
	$script_dir/setup-platform.sh $name $platform
else
    if [ "$platform" == "android" ]; then
        $script_dir/download-latest-android-widgets.sh
        (cd $name && npm install ../tns-core-modules-widgets.tgz)
    fi
	$script_dir/setup-platform.sh $name android
	$script_dir/setup-platform.sh $name ios
fi

cd $name
curl -O https://raw.githubusercontent.com/hamorphis/issue-2184/master/.gitignore
git init
open -a "Visual Studio Code" .

#$script_dir/clean.sh
#$script_dir/run-project.sh $name $platform
