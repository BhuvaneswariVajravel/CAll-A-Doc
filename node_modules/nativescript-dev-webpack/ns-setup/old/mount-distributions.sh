#!/bin/bash
set -e
script_dir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )

echo "Mounting distributions..."

user=$(whoami)
user=${user/TELERIK\\/}  # Strip any domain prefix

if [ ! -d $telerik_com_distributions_mount ]; then
	mkdir $telerik_com_distributions_mount
	echo "Created directory $telerik_com_distributions_mount"
fi

if which mount_smbfs; then
    remotepoint=//$user@TELERIK.COM/distributions/
    mount_smbfs $remotepoint $telerik_com_distributions_mount
elif which mount.cifs; then
    # TODO: mount.cifs has some issues following DFS redirects and doesn't work
    # with the //TELERIK.COM/distributions path.
    remotepoint=//filesrvbg01/distributions/
    sudo mount -t cifs "$remotepoint" $script_dir/telerik_com_distributions_mount -o "user=$user,domain=TELERIK,uid=$user"
else
    echo "Can't mount on this platform!"
    exit 1
fi

echo "Mounted $remotepoint to $telerik_com_distributions_mount"
