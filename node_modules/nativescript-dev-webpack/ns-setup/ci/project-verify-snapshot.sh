#!/bin/bash
set -e

app=$1

if [[ "$PWD" == *release* ]]; then
    echo "You are in release branch."
    if [ -d "$app/platforms/android/src/main/assets/app/tns_modules/application" ]; then
        echo "Standart tns-core-modules found in final package!"
        exit 1
    fi
    unzip -l "$app/platforms/android/build/outputs/apk/"*-release.apk > apk-file-contents.txt
    if unzip -l "$app/platforms/android/build/outputs/apk/"*-release.apk | grep -q libsnapshot.so ; then
        echo "APK contains libsnapshot.so. Snapshot build OK."
    else
        echo "APK doesn't contain libsnapshot.so"
        exit 1
    fi
else
    if [ -d "$app/platforms/android/src/main/assets/app/tns_modules/application" ]; then
        echo "Standart tns-core-modules found in final package!"
        exit 1
    fi
    unzip -l "$app/platforms/android/build/outputs/apk/"*-release.apk > apk-file-contents.txt
    if unzip -l "$app/platforms/android/build/outputs/apk/"*-release.apk | grep -q libsnapshot.so ; then
        echo "APK contains libsnapshot.so. Snapshot build OK."
    else
        echo "APK doesn't contain libsnapshot.so"
        exit 1
    fi
fi
