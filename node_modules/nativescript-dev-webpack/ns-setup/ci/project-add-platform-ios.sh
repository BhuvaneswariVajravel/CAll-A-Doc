#!/bin/bash

# Sample usage:
# ./ns-setup/ci/project-add-platform-ios.sh TestApp

# Spec:
# If current folder contains release then use $IOS_VERSION from Sinopia
# Else use tns-ios.tgz

set -e

if [ "$#" -eq 1 ]; then
    app=$1
    echo "Platform remove"
    node_modules/.bin/tns platform remove ios --path $app && true
    echo "Platform add"
    if [[ "$PWD" == *hotfix* ]]; then
        echo "You are in hotfix branch. Will use Sinopia ..."
        node_modules/.bin/tns platform add ios@$FIX_IOS --path $app
    elif [[ "$PWD" == *release* ]]; then
        echo "You are in release branch. Will use Sinopia ..."
        node_modules/.bin/tns platform add ios@$IOS_VERSION --path $app
    else
        echo "You are in master branch. Will use tns-ios.tgz ..."
        node_modules/.bin/tns platform add ios --frameworkPath tns-ios.tgz --path $app
    fi
else    
    echo "Illegal number of parameters"
    echo "Sample usage:" 
    echo "./ns-setup/ci/project-add-platform-ios.sh TestApp"
    exit 1
fi