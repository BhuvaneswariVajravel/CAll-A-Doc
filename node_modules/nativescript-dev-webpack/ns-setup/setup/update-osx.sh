#!/bin/bash

# TODO: Following line fixes this issue:
# http://stackoverflow.com/questions/9132826/stop-developer-tools-access-needs-to-take-control-of-another-process-for-debugg
# sudo /usr/sbin/DevToolsSecurity --enable

dir="$(dirname "$0")"
"$dir/update-brew-packages.sh"

# This will be executed once per 5 builds or when it is forced
if [[ $BUILD_NUMBER == *5 ]] || [[ $FORCE == true ]]; then
    "$dir/update-pods.sh"
    "$dir/update-android-sdk.sh"
    "$dir/update-android-emulators.sh"
fi
"$dir/clean-caches.sh"
"$dir/reset-emulators.sh"
"$dir/reset-simulators.sh"
# "$dir/update-brew-packages.sh"
"$dir/update-npm-packages.sh"
"$dir/clean-global-workspace.sh"

( 
    cd ~/ && rm -fr ns-setup
    git clone git@github.com:NativeScript/ns-setup.git
    cd ns-setup
    cd nsbuild-proj
    npm i
    ./node_modules/.bin/tsc
    npm pack
    npm uninstall -g nsbuild-proj
    npm i -g nsbuild-proj-0.0.1.tgz
)
