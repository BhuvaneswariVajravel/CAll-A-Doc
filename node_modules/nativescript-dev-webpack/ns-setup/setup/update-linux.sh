#!/bin/bash

dir="$(dirname "$0")"

# TODO: Think about running these scripts at the same time on all build machines,
# as $BUILD_NUMBER is not the same, so they do not run at the same time

# This will be executed once per 10 builds
if [[ $BUILD_NUMBER == *5 ]] || [[ $FORCE == true ]]; then
    "$dir/clean-global-workspace.sh"
    "$dir/update-android-sdk.sh"
    "$dir/update-android-emulators.sh"
fi

"$dir/clean-caches.sh"
"$dir/reset-emulators.sh"
"$dir/update-npm-packages.sh"


( 
    cd ~/ && rm -fr ns-setup
    git clone git@github.com:NativeScript/ns-setup.git
    cd ns-setup
    cd nsbuild-proj
    npm i
    ./node_modules/.bin/tsc
    npm pack
    npm uninstall -g nsbuild-proj
    npm i -g nsbuild-proj-0.0.1.tgz
)

