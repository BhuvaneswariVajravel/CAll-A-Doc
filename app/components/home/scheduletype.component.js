"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var page_1 = require("ui/page");
var requestconsult_model_1 = require("./requestconsult.model");
var radside_component_1 = require("../radside/radside.component");
var web_api_service_1 = require("../../shared/services/web-api.service");
var configuration_1 = require("../../shared/configuration/configuration");
// SCHEDULE TYPE
var ScheduleTypeComponent = (function () {
    function ScheduleTypeComponent(page, router, activatedRoutes) {
        this.page = page;
        this.router = router;
        this.activatedRoutes = activatedRoutes;
        this.isScheduleNow = true;
        this.requestconsult = new requestconsult_model_1.RequestConsultModel();
        this.today = new Date();
        this.tSelectedIndex = 0;
        this.timeRange = [];
        this.showError = false;
        this.dtday = this.today.getDate();
        this.dtmonth = this.today.getMonth() + 1; //January is 0!
        this.dtyear = this.today.getFullYear();
        this.timeRange = ["7: 00 AM", "8: 00 AM", "9: 00 AM", "10: 00 AM", "11: 00 AM", "12: 00 AM", "1: 00 PM", "2: 00 PM", "3: 00 PM", "4: 00 PM", "4: 00 PM", "5: 00 PM", "6: 00 PM", "7: 00 PM"];
    }
    ScheduleTypeComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.page.actionBarHidden = true;
        this.radSideComponent.rcClass = true;
        this.activatedRoutes.queryParams.subscribe(function (params) {
            if (params["REQUEST_CONSULT"] != undefined)
                _this.requestconsult = JSON.parse(params["REQUEST_CONSULT"]);
            _this.isScheduleNow = _this.requestconsult.ScheduleTimeNow;
            if (!_this.isScheduleNow) {
                var selDate = new Date(_this.requestconsult.ScheduleTimeFuture);
                _this.dtday = selDate.getDate();
                _this.dtmonth = selDate.getMonth() + 1;
                _this.dtyear = selDate.getFullYear();
                for (var i = 0; i < _this.timeRange.length; i++) {
                    if (_this.timeRange[i] == _this.requestconsult.ScheduleTimeRange)
                        _this.tSelectedIndex = i;
                }
            }
        });
    };
    ScheduleTypeComponent.prototype.scheduleTypeOnChange = function () {
        this.isScheduleNow = !this.isScheduleNow;
    };
    ScheduleTypeComponent.prototype.configureDateAndTime = function () {
        var _this = this;
        // console.log("execute");
        setTimeout(function () {
            var datePicker = _this.datePicker.nativeElement;
            datePicker.minDate = _this.today;
        }, 1000);
    };
    ScheduleTypeComponent.prototype.goback = function () {
        var navigationExtras = {
            queryParams: { "REQUEST_CONSULT": JSON.stringify(this.requestconsult) }
        };
        this.router.navigate(["/consultationdetails"], navigationExtras);
    };
    ScheduleTypeComponent.prototype.showNextPage = function () {
        if (this.isScheduleNow) {
            this.showError = false;
            this.requestconsult.ScheduleTimeNow = this.isScheduleNow;
            this.requestconsult.ScheduleTimeFuture = "";
            var navigationExtras = {
                queryParams: { "REQUEST_CONSULT": JSON.stringify(this.requestconsult) }
            };
            this.router.navigate(["/healthrecords"], navigationExtras);
        }
        else if (!this.isScheduleNow) {
            var now = new Date();
            var t = this.selectedTime.split(":");
            var t1 = t[1].split(" "), hours = void 0;
            if (t1[2] == "PM" && !(parseInt(t[0]) == 12)) {
                hours = parseInt(t[0]);
                hours = hours + 12;
            }
            else {
                hours = t[0];
            }
            var sDate = this.getSelectedDate();
            sDate.setHours(hours, 0, 0, 0);
            now.setHours(this.today.getHours(), this.today.getMinutes(), this.today.getSeconds(), this.today.getMilliseconds());
            var datePicker = this.datePicker.nativeElement;
            if (sDate > now) {
                this.showError = false;
                this.requestconsult.ScheduleTimeNow = this.isScheduleNow;
                if (!this.isScheduleNow) {
                    this.requestconsult.ScheduleTimeFuture = this.getSelectedDate();
                    this.requestconsult.ScheduleTimeRange = this.selectedTime;
                }
                var navigationExtras = {
                    queryParams: { "REQUEST_CONSULT": JSON.stringify(this.requestconsult) }
                };
                this.router.navigate(["/healthrecords"], navigationExtras);
            }
            else {
                this.showError = true;
            }
        }
    };
    ScheduleTypeComponent.prototype.getSelectedDate = function () {
        var selectedDate = new Date(this.today.getTime());
        var datePicker = this.datePicker.nativeElement;
        if (datePicker.date != undefined) {
            selectedDate.setDate(datePicker.date.getDate());
            selectedDate.setMonth(datePicker.date.getMonth());
            selectedDate.setFullYear(datePicker.date.getFullYear());
        }
        return selectedDate;
    };
    ScheduleTypeComponent.prototype.onTimeChange = function (args) {
        //console.log(this.timeRange[args.value]);
        this.selectedTime = this.timeRange[args.value];
    };
    return ScheduleTypeComponent;
}());
__decorate([
    core_1.ViewChild("date"),
    __metadata("design:type", core_1.ElementRef)
], ScheduleTypeComponent.prototype, "datePicker", void 0);
__decorate([
    core_1.ViewChild("time"),
    __metadata("design:type", core_1.ElementRef)
], ScheduleTypeComponent.prototype, "timePicker", void 0);
__decorate([
    core_1.ViewChild(radside_component_1.RadSideComponent),
    __metadata("design:type", radside_component_1.RadSideComponent)
], ScheduleTypeComponent.prototype, "radSideComponent", void 0);
ScheduleTypeComponent = __decorate([
    core_1.Component({
        moduleId: module.id,
        templateUrl: "./scheduletype.component.html",
        providers: [radside_component_1.RadSideComponent, web_api_service_1.WebAPIService, configuration_1.Configuration]
    }),
    __metadata("design:paramtypes", [page_1.Page, router_1.Router, router_1.ActivatedRoute])
], ScheduleTypeComponent);
exports.ScheduleTypeComponent = ScheduleTypeComponent;
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZWR1bGV0eXBlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNjaGVkdWxldHlwZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBeUU7QUFDekUsMENBQTJFO0FBQzNFLGdDQUErQjtBQUMvQiwrREFBNkQ7QUFDN0Qsa0VBQWdFO0FBR2hFLHlFQUFzRTtBQUN0RSwwRUFBeUU7QUFDekUsZ0JBQWdCO0FBTWhCLElBQWEscUJBQXFCO0lBWWhDLCtCQUFvQixJQUFVLEVBQVUsTUFBYyxFQUFVLGVBQStCO1FBQTNFLFNBQUksR0FBSixJQUFJLENBQU07UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsb0JBQWUsR0FBZixlQUFlLENBQWdCO1FBWHhGLGtCQUFhLEdBQVksSUFBSSxDQUFDO1FBQ3JDLG1CQUFjLEdBQUcsSUFBSSwwQ0FBbUIsRUFBRSxDQUFDO1FBSTNDLFVBQUssR0FBUyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3pCLG1CQUFjLEdBQVcsQ0FBQyxDQUFDO1FBQzNCLGNBQVMsR0FBUSxFQUFFLENBQUM7UUFFcEIsY0FBUyxHQUFZLEtBQUssQ0FBQztRQUd6QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDbEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLGVBQWU7UUFDekQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxTQUFTLEdBQUcsQ0FBQyxVQUFVLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFB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Q0FBQyxDQUFDLENBQUM7WUFDakMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDaEQsWUFBWSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7WUFDbEQsWUFBWSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7UUFDMUQsQ0FBQztRQUNELE1BQU0sQ0FBQyxZQUFZLENBQUM7SUFDdEIsQ0FBQztJQUNELDRDQUFZLEdBQVosVUFBYSxJQUFJO1FBQ2YsMENBQTBDO1FBQzFDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUNILDRCQUFDO0FBQUQsQ0FBQyxBQTFHRCxJQTBHQztBQXRHb0I7SUFBbEIsZ0JBQVMsQ0FBQyxNQUFNLENBQUM7OEJBQWEsaUJBQVU7eURBQUM7QUFDdkI7SUFBbEIsZ0JBQVMsQ0FBQyxNQUFNLENBQUM7OEJBQWEsaUJBQVU7eURBQUM7QUFNYjtJQUE1QixnQkFBUyxDQUFDLG9DQUFnQixDQUFDOzhCQUFtQixvQ0FBZ0I7K0RBQUM7QUFYckQscUJBQXFCO0lBTGpDLGdCQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7UUFDbkIsV0FBVyxFQUFFLCtCQUErQjtRQUM1QyxTQUFTLEVBQUUsQ0FBQyxvQ0FBZ0IsRUFBRSwrQkFBYSxFQUFFLDZCQUFhLENBQUM7S0FDNUQsQ0FBQztxQ0FhMEIsV0FBSSxFQUFrQixlQUFNLEVBQTJCLHVCQUFjO0dBWnBGLHFCQUFxQixDQTBHakM7QUExR1ksc0RBQXFCO0FBMEdqQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBPbkluaXQsIFZpZXdDaGlsZCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBSb3V0ZXIsIEFjdGl2YXRlZFJvdXRlLCBOYXZpZ2F0aW9uRXh0cmFzIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IFBhZ2UgfSBmcm9tIFwidWkvcGFnZVwiO1xuaW1wb3J0IHsgUmVxdWVzdENvbnN1bHRNb2RlbCB9IGZyb20gXCIuL3JlcXVlc3Rjb25zdWx0Lm1vZGVsXCI7XG5pbXBvcnQgeyBSYWRTaWRlQ29tcG9uZW50IH0gZnJvbSBcIi4uL3JhZHNpZGUvcmFkc2lkZS5jb21wb25lbnRcIjtcbmltcG9ydCB7IERhdGVQaWNrZXIgfSBmcm9tIFwidWkvZGF0ZS1waWNrZXJcIjtcbmltcG9ydCB7IFRpbWVQaWNrZXIgfSBmcm9tIFwidWkvdGltZS1waWNrZXJcIjtcbmltcG9ydCB7IFdlYkFQSVNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2hhcmVkL3NlcnZpY2VzL3dlYi1hcGkuc2VydmljZVwiO1xuaW1wb3J0IHsgQ29uZmlndXJhdGlvbiB9IGZyb20gXCIuLi8uLi9zaGFyZWQvY29uZmlndXJhdGlvbi9jb25maWd1cmF0aW9uXCI7XG4vLyBTQ0hFRFVMRSBUWVBFXG5AQ29tcG9uZW50KHtcbiAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgdGVtcGxhdGVVcmw6IFwiLi9zY2hlZHVsZXR5cGUuY29tcG9uZW50Lmh0bWxcIixcbiAgcHJvdmlkZXJzOiBbUmFkU2lkZUNvbXBvbmVudCwgV2ViQVBJU2VydmljZSwgQ29uZmlndXJhdGlvbl1cbn0pXG5leHBvcnQgY2xhc3MgU2NoZWR1bGVUeXBlQ29tcG9uZW50IHtcbiAgcHVibGljIGlzU2NoZWR1bGVOb3c6IGJvb2xlYW4gPSB0cnVlO1xuICByZXF1ZXN0Y29uc3VsdCA9IG5ldyBSZXF1ZXN0Q29uc3VsdE1vZGVsKCk7XG4gIGR0eWVhcjogYW55OyBkdG1vbnRoOiBhbnk7IGR0ZGF5OiBhbnk7XG4gIEBWaWV3Q2hpbGQoXCJkYXRlXCIpIGRhdGVQaWNrZXI6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoXCJ0aW1lXCIpIHRpbWVQaWNrZXI6IEVsZW1lbnRSZWY7XG4gIHRvZGF5OiBEYXRlID0gbmV3IERhdGUoKTtcbiAgdFNlbGVjdGVkSW5kZXg6IG51bWJlciA9IDA7XG4gIHRpbWVSYW5nZTogYW55ID0gW107XG4gIHNlbGVjdGVkVGltZTogc3RyaW5nO1xuICBzaG93RXJyb3I6IGJvb2xlYW4gPSBmYWxzZTtcbiAgQFZpZXdDaGlsZChSYWRTaWRlQ29tcG9uZW50KSByYWRTaWRlQ29tcG9uZW50OiBSYWRTaWRlQ29tcG9uZW50O1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHBhZ2U6IFBhZ2UsIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsIHByaXZhdGUgYWN0aXZhdGVkUm91dGVzOiBBY3RpdmF0ZWRSb3V0ZSkge1xuICAgIHRoaXMuZHRkYXkgPSB0aGlzLnRvZGF5LmdldERhdGUoKTtcbiAgICB0aGlzLmR0bW9udGggPSB0aGlzLnRvZGF5LmdldE1vbnRoKCkgKyAxOyAvL0phbnVhcnkgaXMgMCFcbiAgICB0aGlzLmR0eWVhciA9IHRoaXMudG9kYXkuZ2V0RnVsbFllYXIoKTtcbiAgICB0aGlzLnRpbWVSYW5nZSA9IFtcIjc6IDAwIEFNXCIsIFwiODogMDAgQU1cIiwgXCI5OiAwMCBBTVwiLCBcIjEwOiAwMCBBTVwiLCBcIjExOiAwMCBBTVwiLCBcIjEyOiAwMCBBTVwiLCBcIjE6IDAwIFBNXCIsIFwiMjogMDAgUE1cIiwgXCIzOiAwMCBQTVwiLCBcIjQ6IDAwIFBNXCIsIFwiNDogMDAgUE1cIiwgXCI1OiAwMCBQTVwiLCBcIjY6IDAwIFBNXCIsIFwiNzogMDAgUE1cIl07XG4gIH1cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5wYWdlLmFjdGlvbkJhckhpZGRlbiA9IHRydWU7XG4gICAgdGhpcy5yYWRTaWRlQ29tcG9uZW50LnJjQ2xhc3MgPSB0cnVlO1xuICAgIHRoaXMuYWN0aXZhdGVkUm91dGVzLnF1ZXJ5UGFyYW1zLnN1YnNjcmliZShwYXJhbXMgPT4ge1xuICAgICAgaWYgKHBhcmFtc1tcIlJFUVVFU1RfQ09OU1VMVFwiXSAhPSB1bmRlZmluZWQpXG4gICAgICAgIHRoaXMucmVxdWVzdGNvbnN1bHQgPSBKU09OLnBhcnNlKHBhcmFtc1tcIlJFUVVFU1RfQ09OU1VMVFwiXSk7XG4gICAgICB0aGlzLmlzU2NoZWR1bGVOb3cgPSB0aGlzLnJlcXVlc3Rjb25zdWx0LlNjaGVkdWxlVGltZU5vdztcbiAgICAgIGlmICghdGhpcy5pc1NjaGVkdWxlTm93KSB7XG4gICAgICAgIGxldCBzZWxEYXRlID0gbmV3IERhdGUodGhpcy5yZXF1ZXN0Y29uc3VsdC5TY2hlZHVsZVRpbWVGdXR1cmUpO1xuICAgICAgICB0aGlzLmR0ZGF5ID0gc2VsRGF0ZS5nZXREYXRlKCk7XG4gICAgICAgIHRoaXMuZHRtb250aCA9IHNlbERhdGUuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgIHRoaXMuZHR5ZWFyID0gc2VsRGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudGltZVJhbmdlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKHRoaXMudGltZVJhbmdlW2ldID09IHRoaXMucmVxdWVzdGNvbnN1bHQuU2NoZWR1bGVUaW1lUmFuZ2UpXG4gICAgICAgICAgICB0aGlzLnRTZWxlY3RlZEluZGV4ID0gaTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIHNjaGVkdWxlVHlwZU9uQ2hhbmdlKCkge1xuICAgIHRoaXMuaXNTY2hlZHVsZU5vdyA9ICF0aGlzLmlzU2NoZWR1bGVOb3c7XG4gIH1cbiAgY29uZmlndXJlRGF0ZUFuZFRpbWUoKSB7XG4gICAvLyBjb25zb2xlLmxvZyhcImV4ZWN1dGVcIik7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBsZXQgZGF0ZVBpY2tlcjogRGF0ZVBpY2tlciA9IDxEYXRlUGlja2VyPnRoaXMuZGF0ZVBpY2tlci5uYXRpdmVFbGVtZW50O1xuICAgICAgZGF0ZVBpY2tlci5taW5EYXRlID0gdGhpcy50b2RheTtcbiAgICB9LCAxMDAwKTtcbiAgfVxuICBnb2JhY2soKSB7XG4gICAgbGV0IG5hdmlnYXRpb25FeHRyYXM6IE5hdmlnYXRpb25FeHRyYXMgPSB7XG4gICAgICBxdWVyeVBhcmFtczogeyBcIlJFUVVFU1RfQ09OU1VMVFwiOiBKU09OLnN0cmluZ2lmeSh0aGlzLnJlcXVlc3Rjb25zdWx0KSB9XG4gICAgfTtcbiAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXCIvY29uc3VsdGF0aW9uZGV0YWlsc1wiXSwgbmF2aWdhdGlvbkV4dHJhcyk7XG4gIH1cbiAgc2hvd05leHRQYWdlKCkge1xuICAgIGlmICh0aGlzLmlzU2NoZWR1bGVOb3cpIHtcbiAgICAgIHRoaXMuc2hvd0Vycm9yID0gZmFsc2U7XG4gICAgICB0aGlzLnJlcXVlc3Rjb25zdWx0LlNjaGVkdWxlVGltZU5vdyA9IHRoaXMuaXNTY2hlZHVsZU5vdztcbiAgICAgIHRoaXMucmVxdWVzdGNvbnN1bHQuU2NoZWR1bGVUaW1lRnV0dXJlID0gXCJcIjtcbiAgICAgIGxldCBuYXZpZ2F0aW9uRXh0cmFzOiBOYXZpZ2F0aW9uRXh0cmFzID0ge1xuICAgICAgICBxdWVyeVBhcmFtczogeyBcIlJFUVVFU1RfQ09OU1VMVFwiOiBKU09OLnN0cmluZ2lmeSh0aGlzLnJlcXVlc3Rjb25zdWx0KSB9XG4gICAgICB9O1xuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW1wiL2hlYWx0aHJlY29yZHNcIl0sIG5hdmlnYXRpb25FeHRyYXMpO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMuaXNTY2hlZHVsZU5vdykge1xuICAgICAgbGV0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBsZXQgdDogYW55ID0gdGhpcy5zZWxlY3RlZFRpbWUuc3BsaXQoXCI6XCIpO1xuICAgICAgbGV0IHQxOiBhbnkgPSB0WzFdLnNwbGl0KFwiIFwiKSwgaG91cnM6IG51bWJlcjtcbiAgICAgIGlmICh0MVsyXSA9PSBcIlBNXCIgJiYgIShwYXJzZUludCh0WzBdKSA9PSAxMikpIHtcbiAgICAgICAgaG91cnMgPSBwYXJzZUludCh0WzBdKTtcbiAgICAgICAgaG91cnMgPSBob3VycyArIDEyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaG91cnMgPSB0WzBdO1xuICAgICAgfVxuICAgICAgbGV0IHNEYXRlID0gdGhpcy5nZXRTZWxlY3RlZERhdGUoKTtcbiAgICAgIHNEYXRlLnNldEhvdXJzKGhvdXJzLCAwLCAwLCAwKTtcbiAgICAgIG5vdy5zZXRIb3Vycyh0aGlzLnRvZGF5LmdldEhvdXJzKCksIHRoaXMudG9kYXkuZ2V0TWludXRlcygpLCB0aGlzLnRvZGF5LmdldFNlY29uZHMoKSwgdGhpcy50b2RheS5nZXRNaWxsaXNlY29uZHMoKSk7XG4gICAgICBsZXQgZGF0ZVBpY2tlcjogRGF0ZVBpY2tlciA9IDxEYXRlUGlja2VyPnRoaXMuZGF0ZVBpY2tlci5uYXRpdmVFbGVtZW50O1xuICAgICAgaWYgKHNEYXRlID4gbm93KSB7XG4gICAgICAgIHRoaXMuc2hvd0Vycm9yID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVxdWVzdGNvbnN1bHQuU2NoZWR1bGVUaW1lTm93ID0gdGhpcy5pc1NjaGVkdWxlTm93O1xuICAgICAgICBpZiAoIXRoaXMuaXNTY2hlZHVsZU5vdykge1xuICAgICAgICAgIHRoaXMucmVxdWVzdGNvbnN1bHQuU2NoZWR1bGVUaW1lRnV0dXJlID0gdGhpcy5nZXRTZWxlY3RlZERhdGUoKTtcbiAgICAgICAgICB0aGlzLnJlcXVlc3Rjb25zdWx0LlNjaGVkdWxlVGltZVJhbmdlID0gdGhpcy5zZWxlY3RlZFRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5hdmlnYXRpb25FeHRyYXM6IE5hdmlnYXRpb25FeHRyYXMgPSB7XG4gICAgICAgICAgcXVlcnlQYXJhbXM6IHsgXCJSRVFVRVNUX0NPTlNVTFRcIjogSlNPTi5zdHJpbmdpZnkodGhpcy5yZXF1ZXN0Y29uc3VsdCkgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXCIvaGVhbHRocmVjb3Jkc1wiXSwgbmF2aWdhdGlvbkV4dHJhcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNob3dFcnJvciA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGdldFNlbGVjdGVkRGF0ZSgpOiBEYXRlIHtcbiAgICBsZXQgc2VsZWN0ZWREYXRlID0gbmV3IERhdGUodGhpcy50b2RheS5nZXRUaW1lKCkpO1xuICAgIGxldCBkYXRlUGlja2VyOiBEYXRlUGlja2VyID0gPERhdGVQaWNrZXI+dGhpcy5kYXRlUGlja2VyLm5hdGl2ZUVsZW1lbnQ7XG4gICAgaWYgKGRhdGVQaWNrZXIuZGF0ZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgIHNlbGVjdGVkRGF0ZS5zZXREYXRlKGRhdGVQaWNrZXIuZGF0ZS5nZXREYXRlKCkpO1xuICAgICAgc2VsZWN0ZWREYXRlLnNldE1vbnRoKGRhdGVQaWNrZXIuZGF0ZS5nZXRNb250aCgpKTtcbiAgICAgIHNlbGVjdGVkRGF0ZS5zZXRGdWxsWWVhcihkYXRlUGlja2VyLmRhdGUuZ2V0RnVsbFllYXIoKSk7XG4gICAgfVxuICAgIHJldHVybiBzZWxlY3RlZERhdGU7XG4gIH1cbiAgb25UaW1lQ2hhbmdlKGFyZ3MpIHtcbiAgICAvL2NvbnNvbGUubG9nKHRoaXMudGltZVJhbmdlW2FyZ3MudmFsdWVdKTtcbiAgICB0aGlzLnNlbGVjdGVkVGltZSA9IHRoaXMudGltZVJhbmdlW2FyZ3MudmFsdWVdO1xuICB9XG59O1xuIl19